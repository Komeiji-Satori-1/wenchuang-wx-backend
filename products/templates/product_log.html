{% load static %}

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>äº§å“æ“ä½œæ—¥å¿—</title>
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-5.3.8-dist/css/bootstrap.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
    <style>
        body {
            background-color: #f9f9f9;
        }
        .card {
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .badge {
            font-size: 0.9rem;
            padding: 6px 10px;
        }
        table td, table th {
            vertical-align: middle !important;
        }
        /* ========== æ—¥å¿—é¡µé¢ä¸“ç”¨æ ·å¼ ========== */
        .log-table td {
            text-align: left;
            padding: 10px;
        }
        .log-table th{
            text-align: left;
            padding: 10px;
        }
        .log-action {
            font-weight: bold;
            color: #2563eb;
        }
        .log-diff {
            font-size: 14px;
            background: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 6px;
        }
        .log-time {
            font-size: 13px;
            color: #6b7280;
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-primary mb-0">ğŸ“œ äº§å“æ“ä½œæ—¥å¿—</h3>
            <a href="{% url 'products:product_home' %}" class="btn btn-secondary">
                â† è¿”å›äº§å“ç®¡ç†
            </a>
        </div>

        <table id="logTable" class="table log-table table-striped table-hover table-bordered align-middle text-center">
            <thead class="table-primary">
                <tr>
                    <th>äº§å“</th>
                    <th>æ“ä½œç±»å‹</th>
                    <th>ä¿®æ”¹å‰</th>
                    <th>ä¿®æ”¹å</th>
                    <th>å˜åŠ¨æ•°é‡</th>
                    <th>æ“ä½œäºº</th>
                    <th>æ“ä½œæ—¶é—´</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.product_name }}</td>
                    <td>
                        {% if log.action == "create" %}
                            <span class="badge bg-success">æ–°å¢</span>
                        {% elif log.action == "update" %}
                            <span class="badge bg-primary">ä¿®æ”¹</span>
                        {% elif log.action == "delete" %}
                            <span class="badge bg-danger">åˆ é™¤</span>
                        {% elif log.action == "stock_in" %}
                            <span class="badge bg-danger">è´­å…¥</span>
                        {% else %}
                            <span class="badge bg-danger">å”®å‡º</span>
                        {% endif %}
                    </td>

                    <td class="text-start log-diff">
                        {% if log.old_value.items %}
                            {% for k,v in log.old_value.items %}
                                <div><strong>{{ k }}</strong>ï¼š{{ v }}</div>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">æ— </span>
                        {% endif %}
                    </td>

                    <td class="text-start log-diff">
                        {% if log.new_value.items %}
                            {% for k,v in log.new_value.items %}
                                <div><strong>{{ k }}</strong>ï¼š{{ v }}</div>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">æ— </span>
                        {% endif %}
                    </td>

                    <td>
                        {% if log.change_amount > 0 %}
                            <span class="text-success">+{{ log.change_amount }}</span>
                        {% elif log.change_amount < 0 %}
                            <span class="text-danger">{{ log.change_amount }}</span>
                        {% else %}
                            <span class="text-muted">0</span>
                        {% endif %}
                    </td>

                    <td>{{ log.admin }}</td>
                    <td class="log-time">{{ log.created_at }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- JSä¾èµ– -->
<script src="{% static 'js/jquery-3.7.1.js' %}"></script>
<script src="{% static 'plugins/bootstrap-5.3.8-dist/js/bootstrap.js' %}"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function () {
    $('#logTable').DataTable({
        language: {
            url: 'https://cdn.datatables.net/plug-ins/1.13.8/i18n/zh-CN.json'
        },
        pageLength: 10,
        order: [[6, 'desc']], // é»˜è®¤æŒ‰æ—¶é—´å€’åº
    });
});
</script>
</body>
</html>
